<style>



    .image-container {
    position: relative;
}

.hover-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0; /* Initially hidden */
    transition: opacity 0.3s ease;
}

.image-container:hover .hover-icon {
    opacity: 1; /* Show icon on hover */
}
.heart {
        width: 100px;
        height: 100px;
        position: relative;
    }

    
.hover-icon {
    position: relative;
}

.hover-icon .col-2 {
    position: absolute;
    top: -150px;
    right: -115px;
}
#calendar {
    width: 300px; /* Adjust the width as needed */
    height: 300px; /* Adjust the height as needed */
    overflow: hidden; 
    display: none;/* Hide overflow if necessary */
}






</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ionicons@5.3.0/dist/ionicons.min.css">
{{!-- <link href='https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.css' rel='stylesheet'> --}}
<link href='https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.1/css/all.css' rel='stylesheet'>

  
   <section class="hero-wrap hero-wrap-2 js-fullheight" style="background-image: url('images/bg_3.jpg');" data-stellar-background-ratio="0.5">
      <div class="overlay"></div>
      <div class="container">
        <div class="row no-gutters slider-text js-fullheight align-items-end justify-content-start">
          <div class="col-md-9 ftco-animate pb-5">
          	<p class="breadcrumbs"><span class="mr-2"><a href="/">Home <i class="ion-ios-arrow-forward"></i></a></span> <span>Cars <i class="ion-ios-arrow-forward"></i></span></p>
            <h1 class="mb-3 bread">Choose Your Car</h1>
          </div>
        </div>
      </div>
    </section>
		
    <section class="ftco-section ftco-no-pt bg-light">
    	<div class="container">
    		<div class="row no-gutters">
    			<div class="col-md-12	featured-top">
    				<div class="row no-gutters">
	  					<div class=" col-md-4 d-flex align-items-center ">
	  						<form action="#" class=" request-form ftco-animate glass-effect ">
		          		<h2>Make your trip</h2>
			    				
			    				{{!-- <div class="form-group  px-3 py-0  col-12">
			    					<label for="" class="label px-0">Drop-off location</label>
			    					<input style="border-radius: 10px;" id=""  type="text" class="p-1 col-12" placeholder="City, Airport, Station, etc">
			    				</div> --}}
			    				<div class="d-flex  px-3  row">
			    					<div class="form-group  col-12">
			                <label for="" class="label  text-dark ">Pick-up date</label>
			                <input style="border-radius: 10px;" id="pickDate"  class="p-2 col-12 border rounded" id="book_pick_date" placeholder="Date">
			              </div>
			              <div class="form-group   col-12">
			                <label for="" class="label text-dark ">Drop-off date</label>
			                <input style=""   id="dropDate" class="p-2 rounded col-12 border" id="book_off_date" placeholder="Date">
			              </div>
                           <div id="calendar" class="p-0 m-0" > </div>

                          <div class="form-group col-12 px-3 py-4">
		                
                      <input type="hidden" id="id" value="{{car._id}}" >
					
					 <button id="submitButton"  class="col-12 btn btn-success p-2" type="button">Submit</button>
			    			</form>
	  					</div>
                        
	  				
	  				</div>
                    
				</div>
                
  		</div>
        
    </section>
    

<section class="ftco-section bg-light col-12 row m-0 pt-0 mt-0">
  <aside class="col-md-12">
<div class="col-12 p-2 ftco-section car-wrap rounded ftco-animate  ml-2   ">
   <input class="col-12 p-2" style="border: 0;"  id="search"  type="search" name="serch" placeholder="Search . . .">
</div>
</aside>
 <aside class="col-md-2">
        <!-- Sidebar Content -->
        <div id="transmission" class="align-items-left car-wrap rounded ftco-animate my-0 p-2 ml-2">
         
           <div class="text p-1">

    						<h2 class="mb-0">  Transmission</a></h2>
              </div>
           <input type="checkbox" id="mannual" name="Manual" class="m-1" value="Manual">
            <label for="Manual">Manual</label><br>
            
            <input type="checkbox" id="automatic" name="Automatic" class="m-1" value="Automatic">
            <label for="Automatic">Automatic</label><br>
            </div>
          <div id="engine" class="align-items-left car-wrap rounded ftco-animate my-2 p-2 ml-2">
        
        <div class="text p-1">

    						<h2 class="mb-0"><a > Engine Type</a></h2>
              </div>
         <input type="checkbox" id="Petrol" name="Petrol" class="m-1" value="Petrol">
            <label for="Petrol">Petrol</label><br>
            
            <input type="checkbox" id="Diesel" name="Diesel" class="m-1 " value="Diesel">
            <label for="Diesel">Diesel</label><br>

            </div>
        </div>
          <div id="category" class="align-items-left car-wrap rounded my-2 ftco-animate p-2 ml-2">
    					<div class="text p-1">

    						<h2 class="mb-0"><a >Category</a></h2>
              </div>
              <input type="checkbox" id="MUVs" name="MUVs" class="m-1" value="MUVs">
            <label for="MUVs">MUVs</label><br>
            
            <input type="checkbox" id="SUVs" name="SUVs" class="m-1 " value="SUVs">
            <label for="SUVs">SUVs</label><br>

            <input type="checkbox" id="Sedan" name="Sedan" class="m-1" value="Sedan">
            <label for="Sedan">Sedan</label><br>

            <input type="checkbox" id="Sports Car" name="Sports Car" class="m-1" value="Sports Car">
            <label for="Sports Car">Sports Car</label><br>
            
            <input type="checkbox" id="Hatchbacks" name="Hatchbacks" class="m-1" value="Hatchbacks">
            <label for="Sedan">Hatchbacks</label><br>
            
            <input type="checkbox" id="Electric" name="Electric" class="m-1" value="Electric">
            <label for="Sedan">Electric</label><br>
        </div>
    </aside>
    
  
    <div class="container col-md-10 align-item-center">
                        <div class="rowcars row">
    {{#each data}}
        <div class="col-md-4">
            <div class="car-wrap rounded ftco-animate">
                <div class="image-container position-relative">
                    <img style="height: 325px; object-fit: cover; width: 100%;" alt="Car Image" class="img rounded d-flex align-items-end" src="{{carImage}}">
                    <div class="hover-icon d-flex justify-content-end position-absolute top-0 end-0">
                        <div class="col-2 p-0">
                            <input type="hidden" class="WhislistId" value="{{_id}}">
                            <svg class="wishListButton" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="35" height="35">
                                <path fill="red" stroke="red" stroke-width="3" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="text">
                    <h2 class="mb-0"><a href="carDetails?id={{_id}}">{{carName}}</a></h2>
                    <div class="d-flex mb-3">
                        <span class="cat">{{carModal}}/{{brandName}}</span>
                        <p class="price ml-auto">${{dayRent}} <span>/day</span></p>
                    </div>
                    <p class="d-flex mb-0 d-block">
                         <a href="/bookingCar?carId={{_id}}" class="btn btn-primary py-2 mr-1">Book now</a> 
                        <a href="/carDetails?id={{_id}}" class="btn btn-secondary py-2 ml-1">Details</a>   </p>
                </div>
            </div>
        </div>
    {{/each}}
</div>

{{login}}
            

      
           
        
    </div>
</section>

	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>


<script>
    
    let transmission = [];
    let engine = []
    let category = []
    let searchText = ''

    let locationData = ''
     let pickTimeData= ''
     let pickDateData = ''
     let dropDateData = ''
     let carId = ''


     const submitBtn = document.getElementById('submitButton');
   
    const calendarEl = document.getElementById('calendar');

submitBtn.addEventListener('click', function() {
     pickDateData = document.getElementById('pickDate').value;
     dropDateData = document.getElementById('dropDate').value;
     carId = document.getElementById('id').value;
                $('.container .rowcars').empty();
      console.log(pickDateData)
    calendarEl.style.display = 'none'

      submit()



});

function submit( pickDate, dropDate) {

    axios.post('/addLocationAndDate?id=`${carId}`', {  pickDate, dropDate, carId})
        .then(response => {
            console.log(response.data);
        })
        .catch(error => {
            console.error(error);
        });
}

       $('#transmission input').on('change', function () {
        // Check if the checkbox is checked
        if ($(this).is(':checked')) {
             if (transmission.length === 2){
                transmission = transmission.splice()

            }
            // If checked, add its value to the transmission array
            transmission.push($(this).val());
        } else {
       
            // If unchecked, remove its value from the transmission array
            const index = transmission.indexOf($(this).val());
            if (index !== -1) {
                transmission.splice(index, 1);

            }
        }
        
                $('.container .rowcars').empty();

            submit()})
            
$('#engine input').on('change', function () {
        // Check if the checkbox is checked
        if ($(this).is(':checked')) {
            if (engine.length === 2){
                engine = engine.splice()

            }
            // If checked, add its value to the transmission array
            engine.push($(this).val());
        } else {
            // If unchecked, remove its value from the transmission array
            const index = engine.indexOf($(this).val());
            if (index !== -1) {
                engine.splice(index, 1);

            }
        }
        
        
                $('.container .rowcars').empty();
            submit()})

            $('#category input').on('change', function () {
        // Check if the checkbox is checked
        if ($(this).is(':checked')) {
            if (category.length === 6){
                category = category.splice()

            }
            // If checked, add its value to the transmission array
            category.push($(this).val());
        } else {
            // If unchecked, remove its value from the transmission array
            const index = category.indexOf($(this).val());
            if (index !== -1) {
                category.splice(index, 1);

            }
        }
        
        
                $('.container .rowcars').empty();
            submit()})
    
// Event listener for keydown event in the search input field
// Event listener for keydown event in the search input field
$('#search').on('keydown', function(event) {
    // Check if the Enter key is pressed (keyCode 13)
    if (event.keyCode === 13) {
        // Get the value entered in the search input field
         searchText = $(this).val();

        // Log the search text to the console for testing
        console.log("Search text:", searchText);
          searchCar()
                $('.container .rowcars').empty();

        // Clear the input field after logging the search text (optional)
        $(this).val('');
    }
});




          

function submit(){
  if(transmission.length === 0){
    transmission=['Manual','Automatic']
  }
  if(engine.length === 0){
    engine = ['Petrol','Diesel']
  }
  if(category.length === 0){
    category = ['MUVs','SUVs','Sedan','Sports Car','Hatchbacks','Electric']
  }
    url = '/filterCars'
    console.log(transmission)
    console.log(engine)
    console.log(category)


    axios.post(url,{ transmission:transmission, fuel:engine, carCategory:category ,pickDateData, dropDateData })
     
    .then(response => {
      const cars = response.data;

                    if (cars.length === 0) {
                        // Handle case where no cars match the criteria
                    } else {
                        cars.forEach(car => {
                            const carHtml = `
                                <div class="col-md-4">
                                    <div class="car-wrap rounded ">
                                         <div class="image-container position-relative">
                    <img style="height: 325px; object-fit: cover; width: 100%;" alt="Car Image" class="img rounded d-flex align-items-end" src="${car.carImage}">
                  <div class="hover-icon d-flex justify-content-end position-absolute top-0 end-0">
                        <div class="col-2 p-0">
                            <input type="hidden" class="WhislistId" value="${car._id}">
                            <svg class="wishListButton" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="35" height="35">
                                <path fill="red" stroke="red" stroke-width="3" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                            </svg>
                        </div>
                    </div>
                </div>          <div class="text">
                                            <h2 class="mb-0"><a href="car-single.html">${car.carName}</a></h2>
                                            <div class="d-flex mb-3">
                                                <span class="cat">${car.carModal}/${car.brandName}</span>
                                                <p class="price ml-auto">${car.dayRent} <span>/day</span></p>
                                            </div>
                                            <p class="d-flex mb-0 d-block">
                                                <a href="/bookingCar?carId=${car._id}&&pickDate=${pickDateData}&&dropDate=${dropDateData}&&" class="btn btn-primary py-2 mr-1">Book now</a>
                                                <a href="/carDetails?id=${car._id}&&pickDate=${pickDateData}&&dropDate=${dropDateData}" class="btn btn-secondary py-2 ml-1">Details</a>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            `;
                            $('.container .rowcars').append(carHtml);
                        });
                                        attachWishlistEventListeners();

                    }
                })
    
    .catch(error => {
      console.log(error)
    })
  }

 // Function to attach wishlist button event listeners
function attachWishlistEventListeners() {
    var buttons = document.querySelectorAll('.wishListButton');

    buttons.forEach(function(button) {
        button.addEventListener('click', function() {
            var carId = this.closest('.col-md-4').querySelector('.WhislistId').value;
            console.log('Wishlist ID:', carId);
            axios.post('/addWishList', { carId })
                .then(response => {
                    console.log(response);
                    alert('Add To Wishlist');
                    setTimeout(function() {
                        var alertElement = document.querySelector('.alert');
                        if (alertElement) {
                            alertElement.style.display = 'none';
                        }
                    }, 1000);
                })
                .catch(error => {
                    console.error(error);
                });
        });
    });
}

// Call attachWishlistEventListeners initially
attachWishlistEventListeners();

// Your searchCar function
function searchCar() {
    axios.post('/searchCar', { searchText })
        .then(response => {
            const cars = response.data;

            if (cars.length === 0) {
                // Handle case where no cars match the criteria
            } else {
                cars.forEach(car => {
                     const carHtml = `
                                <div class="col-md-4">
                                    <div class="car-wrap rounded ">
                                         <div class="image-container position-relative">
                    <img style="height: 325px; object-fit: cover; width: 100%;" alt="Car Image" class="img rounded d-flex align-items-end" src="${car.carImage}">
                  <div class="hover-icon d-flex justify-content-end position-absolute top-0 end-0">
                        <div class="col-2 p-0">
                            <input type="hidden" class="WhislistId" value="${car._id}">
                            <svg class="wishListButton" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="35" height="35">
                                <path fill="red" stroke="red" stroke-width="3" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                            </svg>
                        </div>
                    </div>
                </div>          <div class="text">
                                            <h2 class="mb-0"><a href="car-single.html">${car.carName}</a></h2>
                                            <div class="d-flex mb-3">
                                                <span class="cat">${car.carModal}/${car.brandName}</span>
                                                <p class="price ml-auto">${car.dayRent} <span>/day</span></p>
                                            </div>
                                            <p class="d-flex mb-0 d-block">
                                                <a href="/bookingCar?carId=${car._id}&&pickDate=${pickDateData}&&dropDate=${dropDateData}&&" class="btn btn-primary py-2 mr-1">Book now</a>
                                                <a href="/carDetails?id=${car._id}&&pickDate=${pickDateData}&&dropDate=${dropDateData}" class="btn btn-secondary py-2 ml-1">Details</a>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            `;
                       
                    $('.container .rowcars').append(carHtml);
                });

                // Reattach wishlist button event listeners after adding new elements
                attachWishlistEventListeners();
            }
        })
        .catch(error => {
            console.log(error);
        });
}

// Get the input fields for start and end dates
const pickDateInput = document.getElementById('pickDate');
const dropDateInput = document.getElementById('dropDate');


// Add event listeners to open the calendar when the input fields are clicked
pickDateInput.addEventListener('click', function() {
    openCalendar(pickDateInput);
});

dropDateInput.addEventListener('click', function() {
    openCalendar(dropDateInput);
});

function openCalendar(inputField) {
    // Get today's date
    const today = new Date();
    const todayStr = today.toISOString().split('T')[0]; // Format: YYYY-MM-DD

    // Create the FullCalendar instance
    calendarEl.style.display = 'block'
    const calendar = new FullCalendar.Calendar(calendarEl, {
        themeSystem: 'bootstrap',
        initialView: 'dayGridMonth',
        selectable: true,
        select: function(info) {
            // Check if the selected date is today or after today
            if (info.start >= today) {
                // Set the value of the input field to the selected date
                inputField.value = info.startStr;
            } else {
                // Show an error message or handle the invalid selection
                alert('Please select a date today or after today.');
            }
        },
        // Set constraints for date selection (today or after today)
        selectConstraint: {
            start: todayStr, // Start date must be today or after today
            end: '2024-12-31' // End date constraint (optional)
        },
            headerToolbar: {
        start: 'title',
        center: '',
        end: ' prev,next'
    },

    });

    // Render the calendar
    calendar.render();
}



    
          

   
   
 

    // Add event listeners to checkboxes
 
    
</script>

       

